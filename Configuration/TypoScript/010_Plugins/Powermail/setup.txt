plugin.tx_powermail {
	view {
		templateRootPath = EXT:tmpl_sub/Resources/Private/Templates/Extensions/Powermail/Templates/
		layoutRootPath = EXT:tmpl_sub/Resources/Private/Templates/Extensions/Powermail/Layouts/
		partialRootPath = EXT:tmpl_sub/Resources/Private/Templates/Extensions/Powermail/Partials/
	}
}

## setup for Abholtheke dropdown list ##

# visible recipient dropdown list for the user
lib.recipient = COA
lib.recipient {
	10 = TEXT
	10.value = Bitte wÃ¤hlen|[\n]

	20 = CONTENT
	20 {
		table = fe_users
		select.pidInList = {$fe_userPid}
		renderObj = COA
		renderObj {
			10 = TEXT
			10.field = name
			10.wrap = |[\n]
		}
	}
}

# Name of the library as the sender of the answer email
lib.abholtheke = CONTENT
lib.abholtheke {
	table = fe_users
	select {
		pidInList = {$fe_userPid}
		andWhere {
			field = 0
			wrap = name="|"
			htmlSpecialChars = 1
		}
	}

	renderObj = TEXT
	renderObj {
		field = name
	}
}

# Email of the library the confirmation mail to the user will be sent from
lib.emailAbholtheke = CONTENT
lib.emailAbholtheke {
	table = fe_users
	select {
		pidInList = {$fe_userPid}
		andWhere {
			field = 0
			wrap = name="|"
			htmlSpecialChars = 1
		}
	}

	renderObj = TEXT
	renderObj {
		field = email
	}
}

# Sender name and email of the library for the header in the email to user
# $abholthekeformular in the constants
[PIDinRootline = {$abholthekeformular}]
	plugin.tx_powermail {
		settings {
			setup {
				sender {
					overwrite {
						senderName = TEXT
						senderName.value = {f:cObject(typoscriptObjectPath:'lib.abholtheke',data:abholung)}

						senderEmail = TEXT
						senderEmail.value = {f:cObject(typoscriptObjectPath:'lib.emailAbholtheke',data:abholung)}
					}
				}
			}
		}
	}
[global]

## setup for Abholtheke dropdown list - end ##


## setup for bookshelf donation ##

[globalVar = GP:tx_powermail_pi1|uid{$spendeID} = 1]
	lib.select >
	lib.select = COA_INT
	lib.select {
		10 = TEXT
		10.value = <label class="powermail_label" for="powermail_field_uid{$spendeID}">Ihre Spende</label>

		20 = TEXT
		20.value = <select id="powermail_field_uid{$spendeID}" class="powermail_field powermail_select" name="tx_powermail_pi1[field][uid{$spendeID}]"><option value="Regalboden (300 Euro)" selected="selected">Regalboden (300 Euro)</option><option value="Ausstellungsvitrine (5.000 Euro)">Ausstellungsvitrine (5.000 Euro)</option></select>
	}
[else]
	lib.select >
	lib.select = COA_INT
	lib.select {
		10 = TEXT
		10.value = <label class="powermail_label" for="powermail_field_uid{$spendeID}">Ihre Spende</label>

		20 = TEXT
		20.value = <select id="powermail_field_uid{$spendeID}" class="powermail_field powermail_select" name="tx_powermail_pi1[field][uid{$spendeID}]"><option value="Regalboden (300 Euro)">Regalboden (300 Euro)</option><option value="Ausstellungsvitrine (5.000 Euro)" selected="selected">Ausstellungsvitrine (5.000 Euro)</option></select>
	}
[global]

## setup for bookshelf donation - end ##


## setup for book restoration donation ##

# UID des Powermailfeldes ist {$patenschaft.selectID}
# Hole GET-Variable tx_powermail_pi1[uid{$patenschaft.selectID}]:
lib.uebergabe = TEXT
lib.uebergabe.data = GP:tx_powermail_pi1|uid{$patenschaft.selectID}
lib.uebergabe.intval = 1
lib.uebergabe.required = 1
lib.uebergabe.wrap = uid = |

# Alle Buecher aus DB auslesen
# Name of the library as the sender of the answer email
lib.buecher = CONTENT
lib.buecher {
	table = tx_patenschaften_buecher
	select {
		pidInList = {$patenschaft.pidInList}
		where = sponsorship = ""
		andWhere < lib.uebergabe
	}

	renderObj = COA
	renderObj {
		10 = TEXT
		10.field = titel
		10.wrap = |[\n]
	}
}

## setup for book restoration donation - end ##

page.includeJSFooterlibs.powermailJQuery >
